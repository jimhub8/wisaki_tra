Stripe.setPublishableKey(yith_stripe_connect_info.public_key),function(e){function r(r){var o=e("form.checkout, form#order_review, form#add_payment_method"),i="undefined"!=typeof yith_stripe_connect_source_info?yith_stripe_connect_source_info.payment_type:"token";if((o.is(".add-card")||e("input#payment_method_yith-stripe-connect").is(":checked")&&(!e('input[name="wc-yith-stripe-connect-payment-token"]').length||"new"==e('input[name="wc-yith-stripe-connect-payment-token"]:checked').val()))&&0===e("input.stripe-token").size()){o.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var n=e(".wc-credit-card-form-card-name"),c=n.length?n.val():e("#billing_first_name").val()+" "+e("#billing_last_name").val(),a=e(".wc-credit-card-form-card-number"),s=a.val(),l=e(".wc-credit-card-form-card-cvc"),d=l.val(),p=e(".wc-credit-card-form-card-expiry"),m=e.payment.cardExpiryVal(p.val()),f=e("#billing_country"),u=f.val(),_=e("#billing_city:visible"),h=_.val(),v=e("#billing_address_1:visible"),y=v.val(),g=e("#billing_address_2:visible").val(),w=e("select#billing_state, input#billing_state:visible"),b=w.val(),k=e("#billing_postcode:visible"),C=k.val();s=s.replace(/\s/g,"");var S=!1,x=[];return Stripe.validateCardNumber(s)||(S=!0,x.push("card.number"),a.parents("p.form-row").addClass("error")),Stripe.validateCVC(d)||(S=!0,x.push("card.cvc"),l.parents("p.form-row").addClass("error")),Stripe.validateExpiry(m.month,m.year)||(S=!0,x.push("card.expire"),p.parents("p.form-row").addClass("error")),(f.closest("p.form-row.validate-required").length&&f.length&&""==u||_.closest("p.form-row.validate-required").length&&_.length&&""==h||v.closest("p.form-row.validate-required").length&&v.length&&""==y||w.closest("p.form-row.validate-required").length&&w.length&&""==b||k.closest("p.form-row.validate-required").length&&k.length&&""==C)&&(S=!0,x.push("billing.fields"),""==u&&f.parents("p.form-row").addClass("error"),""==h&&_.parents("p.form-row").addClass("error"),""==y&&v.parents("p.form-row").addClass("error"),""==b&&w.parents("p.form-row").addClass("error"),""==C&&k.parents("p.form-row").addClass("error")),S?(t(200,{error:{code:"validation",fieldErrors:x}}),e("fieldset#wc-yith-stripe-connect-cc-form input, fieldset#wc-yith-stripe-connect-cc-form select, fieldset#yith-stripe-connect-cc-form input, fieldset#yith-stripe-connect-cc-form select").one("keydown",function(){e(this).closest("p.form-row.error").removeClass("error")}),e(document).trigger("yith-stripe-connect-card-error")):"token"==i&&Stripe.createToken({number:s,cvc:d,exp_month:m.month,exp_year:m.year,name:c,address_line1:y,address_line2:g,address_city:h,address_state:b,address_zip:C,address_country:u},t),!1}return r}function t(r,t){var o=e("form.checkout, form#order_review, form#add_payment_method"),i=e("#wc-yith-stripe-connect-cc-form, #yith-stripe-connect-cc-form");if(console.log(t),t.error){if(e(".woocommerce-error, .stripe-token",i).remove(),o.unblock(),t.error.message)i.prepend('<ul class="woocommerce-error">'+t.error.message+"</ul>");else if("validation"===t.error.code){for(var n=t.error.fieldErrors,c=n.length,a="",s=0;s<c;s++)a+="<li>"+yith_stripe_connect_info[n[s]]+"</li>";i.prepend('<ul class="woocommerce-error">'+a+"</ul>")}}else i.append('<input type="hidden" class="stripe-token" name="stripe_connect_token" value="'+t.id+'"/>'),o.submit()}e(document).ready(function(){e("form.checkout").on("checkout_place_order_yith-stripe-connect",function(e){return r(e)}),e("form#order_review").on("submit",function(e){return r(e)})})}(jQuery);